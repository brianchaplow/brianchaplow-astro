---
// Interactive Architecture Diagram with animated data flows and clickable VLANs
// For HomeLab SOC v2 - brianchaplow.com
---

<div class="arch-diagram-wrapper not-prose my-12">
  <div class="arch-container">
    
    <!-- Animated background grid -->
    <div class="arch-bg-overlay">
      <div class="arch-grid-pattern"></div>
      <div class="arch-gradient-overlay"></div>
    </div>
    
    <div class="arch-content">
      
      <!-- Header -->
      <div class="arch-header">
        <h3 class="arch-title">System Architecture</h3>
        <p class="arch-subtitle">Click any component or VLAN for details ‚Ä¢ Watch the data flow</p>
      </div>
      
      <!-- === EDGE LAYER === -->
      <div class="arch-layer" data-layer="edge">
        <div class="arch-layer-label arch-label-edge">
          <span class="arch-label-dot"></span>
          Edge Security
        </div>
        
        <div class="arch-nodes-center">
          <button class="arch-node arch-node-edge" data-component="cloudflare" aria-label="Cloudflare details" type="button">
            <div class="arch-node-glow"></div>
            <div class="arch-node-inner">
              <div class="arch-node-icon">üõ°Ô∏è</div>
              <div class="arch-node-name">Cloudflare</div>
              <div class="arch-node-detail">WAF ‚Ä¢ Bot Fight ‚Ä¢ JA3</div>
              <div class="arch-node-status arch-status-online">
                <span class="arch-status-dot"></span>
                Protecting
              </div>
            </div>
          </button>
        </div>
        
        <!-- Protected Sites -->
        <div class="arch-protected-sites">
          <div class="arch-sites-label">Protected Sites</div>
          <div class="arch-sites-list">
            <a href="https://brianchaplow.com" class="arch-site-badge" target="_blank" rel="noopener">
              <span class="arch-site-dot"></span>
              brianchaplow.com
            </a>
            <a href="https://bytesbourbonbbq.com" class="arch-site-badge" target="_blank" rel="noopener">
              <span class="arch-site-dot"></span>
              bytesbourbonbbq.com
            </a>
          </div>
        </div>
      </div>
      
      <!-- Connection with animated flow -->
      <div class="arch-flow-connector">
        <div class="arch-flow-line"></div>
        <div class="arch-flow-particles">
          <div class="arch-particle" style="--delay: 0s"></div>
          <div class="arch-particle" style="--delay: 0.5s"></div>
          <div class="arch-particle" style="--delay: 1s"></div>
        </div>
        <div class="arch-flow-label">HTTPS</div>
      </div>
      
      <!-- === CLOUD LAYER === -->
      <div class="arch-layer" data-layer="cloud">
        <div class="arch-layer-label arch-label-cloud">
          <span class="arch-label-dot"></span>
          Cloud Hosting
        </div>
        
        <div class="arch-nodes-center">
          <button class="arch-node arch-node-cloud" data-component="gcp" aria-label="GCP VM details" type="button">
            <div class="arch-node-glow"></div>
            <div class="arch-node-inner">
              <div class="arch-node-icon">‚òÅÔ∏è</div>
              <div class="arch-node-name">GCP VM</div>
              <div class="arch-node-detail">Apache ‚Ä¢ Fluent Bit</div>
              <div class="arch-node-badge">e2-small ‚Ä¢ us-east4</div>
            </div>
          </button>
        </div>
      </div>
      
      <!-- VPN Connection -->
      <div class="arch-flow-connector arch-flow-vpn">
        <div class="arch-flow-line arch-line-encrypted"></div>
        <div class="arch-flow-particles arch-particles-encrypted">
          <div class="arch-particle" style="--delay: 0s"></div>
          <div class="arch-particle" style="--delay: 0.4s"></div>
          <div class="arch-particle" style="--delay: 0.8s"></div>
        </div>
        <div class="arch-flow-label arch-label-vpn">
          <svg class="arch-lock-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
          </svg>
          Tailscale VPN
        </div>
      </div>
      
      <!-- === FIREWALL LAYER === -->
      <div class="arch-layer" data-layer="firewall">
        <div class="arch-layer-label arch-label-firewall">
          <span class="arch-label-dot"></span>
          Network Perimeter
        </div>
        
        <div class="arch-nodes-center">
          <button class="arch-node arch-node-firewall" data-component="opnsense" aria-label="OPNsense details" type="button">
            <div class="arch-node-glow"></div>
            <div class="arch-node-inner">
              <div class="arch-node-icon">üî•</div>
              <div class="arch-node-name">OPNsense</div>
              <div class="arch-node-detail">Protectli VP2420</div>
              <div class="arch-node-ip">10.10.10.1</div>
            </div>
          </button>
        </div>
      </div>
      
      <div class="arch-flow-connector">
        <div class="arch-flow-line"></div>
        <div class="arch-flow-particles">
          <div class="arch-particle" style="--delay: 0.2s"></div>
          <div class="arch-particle" style="--delay: 0.7s"></div>
        </div>
      </div>
      
      <!-- === CORE INFRASTRUCTURE === -->
      <div class="arch-layer" data-layer="core">
        <div class="arch-layer-label arch-label-core">
          <span class="arch-label-dot"></span>
          Core Infrastructure
        </div>
        
        <div class="arch-nodes-row">
          <button class="arch-node arch-node-switch" data-component="switch" aria-label="Switch details" type="button">
            <div class="arch-node-glow"></div>
            <div class="arch-node-inner">
              <div class="arch-node-icon">üîÄ</div>
              <div class="arch-node-name">MokerLink 10G</div>
              <div class="arch-node-detail">12-Port ‚Ä¢ SPAN ‚Üí SOC</div>
              <div class="arch-node-ip">10.10.10.2</div>
            </div>
          </button>
          
          <button class="arch-node arch-node-soc" data-component="soc" aria-label="SOC details" type="button">
            <div class="arch-node-glow"></div>
            <div class="arch-node-inner">
              <div class="arch-node-icon">üñ•Ô∏è</div>
              <div class="arch-node-name">QNAP SOC</div>
              <div class="arch-node-detail">OpenSearch ‚Ä¢ Suricata</div>
              <div class="arch-node-ip">10.10.20.10</div>
              <div class="arch-node-status arch-status-online">
                <span class="arch-status-dot"></span>
                9 Containers
              </div>
            </div>
          </button>
        </div>
      </div>
      
      <div class="arch-flow-connector">
        <div class="arch-flow-line"></div>
        <div class="arch-flow-particles arch-particles-multi">
          <div class="arch-particle" style="--delay: 0s; --offset: -10px"></div>
          <div class="arch-particle" style="--delay: 0.3s; --offset: 0px"></div>
          <div class="arch-particle" style="--delay: 0.6s; --offset: 10px"></div>
        </div>
      </div>
      
      <!-- === VLAN SEGMENTS === -->
      <div class="arch-layer" data-layer="segments">
        <div class="arch-layer-label arch-label-segments">
          <span class="arch-label-dot"></span>
          Network Segments
          <span class="arch-click-hint">(click to explore)</span>
        </div>
        
        <div class="arch-vlan-grid">
          <button class="arch-vlan-card arch-vlan-mgmt" data-vlan="10" type="button">
            <div class="arch-vlan-id">VLAN 10</div>
            <div class="arch-vlan-name">Management</div>
            <div class="arch-vlan-subnet">10.10.10.0/24</div>
            <div class="arch-vlan-count">3 devices</div>
          </button>
          <button class="arch-vlan-card arch-vlan-soc" data-vlan="20" type="button">
            <div class="arch-vlan-id">VLAN 20</div>
            <div class="arch-vlan-name">SOC</div>
            <div class="arch-vlan-subnet">10.10.20.0/24</div>
            <div class="arch-vlan-badge arch-badge-soc">QNAP + Kali</div>
            <div class="arch-vlan-count">2 devices</div>
          </button>
          <button class="arch-vlan-card arch-vlan-lab" data-vlan="30" type="button">
            <div class="arch-vlan-id">VLAN 30</div>
            <div class="arch-vlan-name">Lab</div>
            <div class="arch-vlan-subnet">10.10.30.0/24</div>
            <div class="arch-vlan-badge arch-badge-lab">Proxmox + AD</div>
            <div class="arch-vlan-count">4 devices</div>
          </button>
          <button class="arch-vlan-card arch-vlan-targets" data-vlan="40" type="button">
            <div class="arch-vlan-id">VLAN 40</div>
            <div class="arch-vlan-name">Targets</div>
            <div class="arch-vlan-subnet">10.10.40.0/24</div>
            <div class="arch-vlan-badge arch-badge-targets">Isolated</div>
            <div class="arch-vlan-count">3 VMs</div>
          </button>
          <button class="arch-vlan-card arch-vlan-iot" data-vlan="50" type="button">
            <div class="arch-vlan-id">VLAN 50</div>
            <div class="arch-vlan-name">IoT</div>
            <div class="arch-vlan-subnet">10.10.50.0/24</div>
            <div class="arch-vlan-badge arch-badge-iot">Hue + Eufy</div>
            <div class="arch-vlan-count">5+ devices</div>
          </button>
        </div>
      </div>
      
      <!-- === DATA FLOWS LEGEND === -->
      <div class="arch-data-flows">
        <div class="arch-flows-title">Data Flows</div>
        <div class="arch-flows-grid">
          <div class="arch-flow-item">
            <div class="arch-flow-item-icon">üåê</div>
            <div class="arch-flow-item-info">
              <div class="arch-flow-item-name">Production Traffic</div>
              <div class="arch-flow-item-path">
                Sites ‚Üí Cloudflare ‚Üí GCP ‚Üí <span class="arch-highlight">Fluent Bit</span> ‚Üí <span class="arch-highlight">OpenSearch</span>
              </div>
            </div>
          </div>
          <div class="arch-flow-item">
            <div class="arch-flow-item-icon">üîç</div>
            <div class="arch-flow-item-info">
              <div class="arch-flow-item-name">Network Detection</div>
              <div class="arch-flow-item-path">
                All VLANs ‚Üí SPAN ‚Üí <span class="arch-highlight">Suricata</span> (47,487 rules) ‚Üí <span class="arch-highlight">OpenSearch</span>
              </div>
            </div>
          </div>
          <div class="arch-flow-item">
            <div class="arch-flow-item-icon">üñ•Ô∏è</div>
            <div class="arch-flow-item-info">
              <div class="arch-flow-item-name">Endpoint Telemetry</div>
              <div class="arch-flow-item-path">
                Windows ‚Üí <span class="arch-highlight">Sysmon</span> ‚Üí Fluent Bit ‚Üí <span class="arch-highlight">OpenSearch</span>
              </div>
            </div>
          </div>
          <div class="arch-flow-item">
            <div class="arch-flow-item-icon">üö´</div>
            <div class="arch-flow-item-info">
              <div class="arch-flow-item-name">Automated Response</div>
              <div class="arch-flow-item-path">
                New IP ‚Üí <span class="arch-highlight">AbuseIPDB</span> ‚Üí Score ‚â•90 ‚Üí <span class="arch-highlight">Cloudflare Block</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Detail Panel (shows on component/VLAN click) -->
  <div id="arch-detail-panel" class="arch-detail-panel arch-panel-hidden" role="dialog" aria-labelledby="arch-detail-title">
    <button class="arch-detail-close" aria-label="Close details" type="button">&times;</button>
    <h4 id="arch-detail-title" class="arch-detail-title"></h4>
    <div id="arch-detail-content" class="arch-detail-content"></div>
  </div>
</div>

<style is:global>
  /* ============================================
     ARCHITECTURE DIAGRAM - GLOBAL STYLES
     Using unique prefixes to avoid conflicts
     ============================================ */
  
  .arch-diagram-wrapper {
    --arch-edge: #f97316;
    --arch-cloud: #3b82f6;
    --arch-firewall: #ef4444;
    --arch-core: #00d4ff;
    --arch-segments: #00ff88;
    --arch-iot: #a855f7;
    --arch-targets: #f97316;
    position: relative;
  }
  
  .arch-container {
    position: relative;
    background: linear-gradient(180deg, #0c0c14 0%, #080810 100%);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 1rem;
    overflow: hidden;
  }
  
  .arch-bg-overlay {
    position: absolute;
    inset: 0;
    overflow: hidden;
    border-radius: 1rem;
  }
  
  .arch-grid-pattern {
    position: absolute;
    inset: 0;
    opacity: 0.3;
    background-image: 
      linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    animation: archGridMove 20s linear infinite;
  }
  
  @keyframes archGridMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(40px, 40px); }
  }
  
  .arch-gradient-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(12,12,20,0.5) 0%, transparent 50%, rgba(8,8,16,0.8) 100%);
  }
  
  .arch-content {
    position: relative;
    padding: 2rem 2rem 2rem;
  }
  
  @media (min-width: 768px) {
    .arch-content {
      padding: 3rem;
    }
  }
  
  /* Header */
  .arch-header {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .arch-title {
    font-family: 'JetBrains Mono', ui-monospace, monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: rgba(0, 212, 255, 0.7);
    margin: 0 0 0.5rem 0;
  }
  
  .arch-subtitle {
    color: #666;
    font-size: 0.875rem;
    margin: 0;
  }
  
  /* Layer Labels */
  .arch-layer {
    margin-bottom: 0.5rem;
  }
  
  .arch-layer-label {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'JetBrains Mono', ui-monospace, monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: #666;
    margin-bottom: 1rem;
  }
  
  .arch-label-dot {
    width: 4px;
    height: 14px;
    border-radius: 2px;
    background: currentColor;
  }
  
  .arch-click-hint {
    font-size: 0.6rem;
    opacity: 0.6;
    font-style: italic;
    text-transform: none;
    letter-spacing: normal;
  }
  
  .arch-label-edge { color: var(--arch-edge); }
  .arch-label-cloud { color: var(--arch-cloud); }
  .arch-label-firewall { color: var(--arch-firewall); }
  .arch-label-core { color: var(--arch-core); }
  .arch-label-segments { color: var(--arch-segments); }
  
  /* Nodes Layout */
  .arch-nodes-center {
    display: flex;
    justify-content: center;
  }
  
  .arch-nodes-row {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    flex-wrap: wrap;
  }
  
  /* Arch Nodes */
  .arch-node {
    position: relative;
    background: rgba(20, 20, 30, 0.8);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 1rem;
    padding: 1.25rem 1.75rem;
    min-width: 160px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
    color: inherit;
  }
  
  .arch-node:hover {
    transform: translateY(-4px);
    border-color: rgba(255,255,255,0.2);
  }
  
  .arch-node-edge:hover { 
    border-color: var(--arch-edge); 
    box-shadow: 0 8px 30px -10px rgba(249,115,22,0.3); 
  }
  .arch-node-cloud:hover { 
    border-color: var(--arch-cloud); 
    box-shadow: 0 8px 30px -10px rgba(59,130,246,0.3); 
  }
  .arch-node-firewall:hover { 
    border-color: var(--arch-firewall); 
    box-shadow: 0 8px 30px -10px rgba(239,68,68,0.3); 
  }
  .arch-node-switch:hover { 
    border-color: var(--arch-core); 
    box-shadow: 0 8px 30px -10px rgba(0,212,255,0.3); 
  }
  .arch-node-soc { 
    border-color: rgba(0,212,255,0.4); 
    background: rgba(0,212,255,0.05); 
  }
  .arch-node-soc:hover { 
    border-color: var(--arch-core); 
    box-shadow: 0 8px 30px -10px rgba(0,212,255,0.4); 
  }
  
  .arch-node-glow {
    position: absolute;
    inset: -1px;
    border-radius: 1rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  
  .arch-node:hover .arch-node-glow {
    opacity: 1;
  }
  
  .arch-node-edge .arch-node-glow { box-shadow: inset 0 0 20px rgba(249,115,22,0.15); }
  .arch-node-cloud .arch-node-glow { box-shadow: inset 0 0 20px rgba(59,130,246,0.15); }
  .arch-node-firewall .arch-node-glow { box-shadow: inset 0 0 20px rgba(239,68,68,0.15); }
  .arch-node-switch .arch-node-glow, 
  .arch-node-soc .arch-node-glow { box-shadow: inset 0 0 20px rgba(0,212,255,0.15); }
  
  .arch-node-inner { position: relative; }
  .arch-node-icon { font-size: 1.75rem; margin-bottom: 0.5rem; }
  .arch-node-name { font-weight: 600; font-size: 0.95rem; color: #fff; }
  .arch-node-detail { 
    font-family: 'JetBrains Mono', monospace; 
    font-size: 0.65rem; 
    color: #888; 
    margin-top: 0.25rem; 
  }
  
  .arch-node-badge, .arch-node-ip {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--arch-segments);
    background: rgba(0,255,136,0.1);
    padding: 0.2rem 0.6rem;
    border-radius: 0.25rem;
    margin-top: 0.5rem;
    display: inline-block;
  }
  
  .arch-node-status {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    margin-top: 0.5rem;
    font-size: 0.65rem;
    color: #888;
  }
  
  .arch-status-online { color: var(--arch-segments); }
  
  .arch-status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    animation: archPulse 2s ease-in-out infinite;
  }
  
  @keyframes archPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }
  
  /* Protected Sites */
  .arch-protected-sites {
    text-align: center;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(249,115,22,0.08) 0%, rgba(239,68,68,0.04) 100%);
    border: 1px solid rgba(249,115,22,0.2);
    border-radius: 0.75rem;
    max-width: 400px;
    margin: 1.5rem auto 0;
  }
  
  .arch-sites-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--arch-edge);
    margin-bottom: 0.5rem;
  }
  
  .arch-sites-list {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  
  .arch-site-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    font-weight: 500;
    color: #fff;
    background: rgba(249,115,22,0.15);
    padding: 0.4rem 0.75rem;
    border-radius: 0.4rem;
    text-decoration: none;
    transition: all 0.2s ease;
  }
  
  .arch-site-badge:hover {
    background: rgba(249,115,22,0.25);
    transform: translateY(-1px);
    color: #fff;
  }
  
  .arch-site-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--arch-segments);
    animation: archPulse 2s ease-in-out infinite;
  }
  
  /* Flow Connectors */
  .arch-flow-connector {
    position: relative;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .arch-flow-line {
    position: absolute;
    width: 2px;
    height: 100%;
    background: linear-gradient(180deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
  }
  
  .arch-line-encrypted {
    background: linear-gradient(180deg, rgba(139,92,246,0.4), rgba(139,92,246,0.1));
  }
  
  .arch-flow-particles {
    position: absolute;
    width: 2px;
    height: 100%;
  }
  
  .arch-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--arch-core);
    border-radius: 50%;
    animation: archFlowDown 2s ease-in-out infinite;
    animation-delay: var(--delay);
    box-shadow: 0 0 6px var(--arch-core);
  }
  
  .arch-particles-encrypted .arch-particle {
    background: #8b5cf6;
    box-shadow: 0 0 6px #8b5cf6;
  }
  
  .arch-particles-multi .arch-particle {
    left: calc(50% + var(--offset, 0px));
  }
  
  @keyframes archFlowDown {
    0% { top: 0; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { top: 100%; opacity: 0; }
  }
  
  .arch-flow-label {
    position: relative;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: #666;
    background: #0c0c14;
    padding: 0.2rem 0.5rem;
    border-radius: 0.25rem;
  }
  
  .arch-label-vpn {
    color: #8b5cf6;
    background: rgba(139,92,246,0.1);
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }
  
  .arch-lock-icon {
    width: 12px;
    height: 12px;
  }
  
  /* VLAN Grid */
  .arch-vlan-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 0.75rem;
  }
  
  .arch-vlan-card {
    position: relative;
    background: rgba(0,255,136,0.03);
    border: 1px solid rgba(0,255,136,0.15);
    border-radius: 0.75rem;
    padding: 1rem;
    text-align: center;
    transition: all 0.2s ease;
    cursor: pointer;
    font-family: inherit;
    color: inherit;
  }
  
  .arch-vlan-card:hover {
    border-color: rgba(0,255,136,0.4);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px -5px rgba(0,255,136,0.2);
  }
  
  .arch-vlan-mgmt {
    border-color: rgba(34,197,94,0.3);
    background: rgba(34,197,94,0.05);
  }
  .arch-vlan-mgmt:hover {
    border-color: rgba(34,197,94,0.5);
    box-shadow: 0 4px 20px -5px rgba(34,197,94,0.2);
  }
  
  .arch-vlan-soc {
    border-color: rgba(0,212,255,0.4);
    background: rgba(0,212,255,0.08);
  }
  .arch-vlan-soc:hover {
    border-color: rgba(0,212,255,0.6);
    box-shadow: 0 4px 20px -5px rgba(0,212,255,0.3);
  }
  
  .arch-vlan-lab {
    border-color: rgba(0,255,136,0.3);
    background: rgba(0,255,136,0.05);
  }
  
  .arch-vlan-targets {
    border-color: rgba(249,115,22,0.3);
    background: rgba(249,115,22,0.05);
  }
  .arch-vlan-targets:hover {
    border-color: rgba(249,115,22,0.5);
    box-shadow: 0 4px 20px -5px rgba(249,115,22,0.2);
  }
  
  .arch-vlan-iot {
    border-color: rgba(168,85,247,0.3);
    background: rgba(168,85,247,0.05);
  }
  .arch-vlan-iot:hover {
    border-color: rgba(168,85,247,0.5);
    box-shadow: 0 4px 20px -5px rgba(168,85,247,0.2);
  }
  
  .arch-vlan-id {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    font-weight: 600;
    color: var(--arch-segments);
  }
  
  .arch-vlan-mgmt .arch-vlan-id { color: #22c55e; }
  .arch-vlan-soc .arch-vlan-id { color: #00d4ff; }
  .arch-vlan-targets .arch-vlan-id { color: #f97316; }
  .arch-vlan-iot .arch-vlan-id { color: #a855f7; }
  
  .arch-vlan-name {
    font-size: 0.85rem;
    font-weight: 600;
    color: #fff;
    margin: 0.25rem 0;
  }
  
  .arch-vlan-subnet {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: #666;
  }
  
  .arch-vlan-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.55rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.15rem 0.4rem;
    border-radius: 0.2rem;
    margin-top: 0.4rem;
    display: inline-block;
    background: rgba(0,255,136,0.15);
    color: #00ff88;
  }
  
  .arch-badge-soc {
    background: rgba(0,212,255,0.2);
    color: #00d4ff;
  }
  
  .arch-badge-lab {
    background: rgba(0,255,136,0.15);
    color: #00ff88;
  }
  
  .arch-badge-targets {
    background: rgba(249,115,22,0.2);
    color: #f97316;
  }
  
  .arch-badge-iot {
    background: rgba(168,85,247,0.2);
    color: #a855f7;
  }
  
  .arch-vlan-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.55rem;
    color: #555;
    margin-top: 0.35rem;
  }
  
  /* Data Flows */
  .arch-data-flows {
    margin-top: 2.5rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255,255,255,0.1);
  }
  
  .arch-flows-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: #666;
    text-align: center;
    margin-bottom: 1.25rem;
  }
  
  .arch-flows-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    max-width: 700px;
    margin: 0 auto;
  }
  
  @media (max-width: 640px) {
    .arch-flows-grid {
      grid-template-columns: 1fr;
      max-width: 100%;
    }
  }
  
  .arch-flow-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.875rem;
    background: rgba(255,255,255,0.02);
    border-radius: 0.5rem;
    border: 1px solid rgba(255,255,255,0.05);
    transition: all 0.2s ease;
    min-height: 5.5rem;
  }
  
  .arch-flow-item:hover {
    background: rgba(255,255,255,0.04);
  }
  
  .arch-flow-item-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
  }
  
  .arch-flow-item-info { flex: 1; }
  
  .arch-flow-item-name {
    font-size: 0.8rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.25rem;
  }
  
  .arch-flow-item-path {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    color: #666;
    line-height: 1.6;
  }
  
  .arch-highlight {
    color: var(--arch-core);
  }
  
  /* Detail Panel */
  .arch-detail-panel {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 340px;
    max-height: 80vh;
    overflow-y: auto;
    background: rgba(15,15,25,0.98);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 1rem;
    padding: 1.5rem;
    z-index: 1000;
    box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5);
    transition: all 0.3s ease;
  }
  
  .arch-panel-hidden {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
  }
  
  .arch-detail-close {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    width: 28px;
    height: 28px;
    border: none;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    color: #888;
    cursor: pointer;
    font-size: 1.25rem;
    line-height: 1;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .arch-detail-close:hover {
    background: rgba(255,255,255,0.15);
    color: #fff;
  }
  
  .arch-detail-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #fff;
    margin: 0 0 1rem 0;
    padding-right: 2rem;
  }
  
  .arch-detail-content {
    font-size: 0.85rem;
    color: #a0a0a0;
    line-height: 1.6;
  }
  
  .arch-detail-content p {
    margin: 0 0 0.5rem 0;
  }
  
  .arch-detail-content strong {
    color: #fff;
  }
  
  .arch-detail-content code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    background: rgba(255,255,255,0.1);
    padding: 0.15rem 0.4rem;
    border-radius: 0.25rem;
  }
  
  .arch-detail-content ul {
    margin: 0.5rem 0;
    padding-left: 1rem;
    font-size: 0.8rem;
  }
  
  .arch-detail-content li {
    margin-bottom: 0.25rem;
  }
  
  /* Device list in detail panel */
  .arch-device-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }
  
  .arch-device-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0.75rem;
    background: rgba(255,255,255,0.03);
    border-radius: 0.5rem;
    border-left: 3px solid var(--arch-core);
  }
  
  .arch-device-name {
    font-weight: 500;
    color: #fff;
    font-size: 0.85rem;
  }
  
  .arch-device-role {
    font-size: 0.7rem;
    color: #666;
  }
  
  .arch-device-ip {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--arch-segments);
    background: rgba(0,255,136,0.1);
    padding: 0.15rem 0.4rem;
    border-radius: 0.25rem;
  }
  
  .arch-vlan-note {
    margin-top: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: rgba(249,115,22,0.1);
    border: 1px solid rgba(249,115,22,0.2);
    border-radius: 0.5rem;
    font-size: 0.75rem;
    color: #f97316;
  }
  
  .arch-vlan-note.arch-note-info {
    background: rgba(0,212,255,0.1);
    border-color: rgba(0,212,255,0.2);
    color: #00d4ff;
  }
  
  /* Responsive adjustments */
  @media (max-width: 640px) {
    .arch-detail-panel {
      left: 1rem;
      right: 1rem;
      bottom: 1rem;
      width: auto;
    }
    
    .arch-nodes-row {
      gap: 1rem;
    }
    
    .arch-vlan-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<script>
  // Component details data
  const componentDetails: Record<string, { title: string; content: string }> = {
    cloudflare: {
      title: 'üõ°Ô∏è Cloudflare Edge Security',
      content: `
        <p><strong>Role:</strong> First line of defense, hiding origin server IP and filtering malicious traffic.</p>
        <p style="margin-top: 0.5rem;"><strong>Features enabled:</strong></p>
        <ul>
          <li>Web Application Firewall (WAF)</li>
          <li>Bot Fight Mode</li>
          <li>JA3 TLS Fingerprinting</li>
          <li>API-driven IP blocking</li>
        </ul>
        <p style="margin-top: 0.5rem;"><strong>Auto-blocks:</strong> <code>2,000+ IPs</code> via SOC automation</p>
      `
    },
    gcp: {
      title: '‚òÅÔ∏è Google Cloud Platform',
      content: `
        <p><strong>Instance:</strong> e2-small in us-east4-a</p>
        <p><strong>Public IP:</strong> <code>[redacted]</code></p>
        <p><strong>Tailscale:</strong> <code>[mesh-ip]</code></p>
        <p style="margin-top: 0.5rem;"><strong>Services:</strong></p>
        <ul>
          <li>Apache 2.4 with HTTP/2</li>
          <li>Let's Encrypt SSL</li>
          <li>Fluent Bit log shipper</li>
          <li>Umami analytics (:3000)</li>
        </ul>
      `
    },
    opnsense: {
      title: 'üî• OPNsense Firewall',
      content: `
        <p><strong>Hardware:</strong> Protectli VP2420</p>
        <p><strong>Management:</strong> <code>https://10.10.10.1</code></p>
        <p style="margin-top: 0.5rem;"><strong>VLAN Gateways:</strong></p>
        <ul style="font-family: monospace; font-size: 0.75rem;">
          <li>VLAN 10: 10.10.10.1 (Mgmt)</li>
          <li>VLAN 20: 10.10.20.1 (SOC)</li>
          <li>VLAN 30: 10.10.30.1 (Lab)</li>
          <li>VLAN 40: 10.10.40.1 (Targets)</li>
          <li>VLAN 50: 10.10.50.1 (IoT)</li>
        </ul>
      `
    },
    switch: {
      title: 'üîÄ MokerLink 12-Port 10G Switch',
      content: `
        <p><strong>Management:</strong> <code>http://10.10.10.2</code></p>
        <p><strong>Trunk Port:</strong> TE1 ‚Üí Protectli (all VLANs)</p>
        <p style="margin-top: 0.5rem;"><strong>Port Assignments:</strong></p>
        <ul>
          <li>TE2-3: Proxmox hosts (VLAN 30)</li>
          <li>TE4: Kali (VLAN 20)</li>
          <li>TE5: IoT switch (VLAN 50)</li>
          <li>TE6: Management laptop (VLAN 10)</li>
          <li>TE9-10 (SFP+): QNAP (VLAN 20)</li>
        </ul>
        <p style="margin-top: 0.5rem;"><strong>SPAN:</strong> All ports mirror ‚Üí TE10</p>
      `
    },
    soc: {
      title: 'üñ•Ô∏è QNAP SOC Platform (smokehouse)',
      content: `
        <p><strong>Primary IP:</strong> <code>10.10.20.10</code> (eth5, SFP+)</p>
        <p><strong>SPAN Interface:</strong> eth4 (no IP, capture only)</p>
        <p><strong>Tailscale:</strong> <code>[mesh-ip]</code></p>
        <p style="margin-top: 0.5rem;"><strong>9 Containers:</strong></p>
        <ul>
          <li>OpenSearch: <code>:9200</code> / <code>:5601</code></li>
          <li>Suricata: 47,487 rules on eth4</li>
          <li>Fluent Bit: <code>:5514</code> (syslog)</li>
          <li>CyberChef: <code>:8000</code></li>
          <li>Zeek, soc-automation, InfluxDB, Grafana</li>
        </ul>
        <p style="margin-top: 0.5rem;"><strong>SSH:</strong> <code>ssh -p 2222 bchaplow@10.10.20.10</code></p>
      `
    }
  };

  // VLAN details data with device lists
  const vlanDetails: Record<string, { title: string; devices: Array<{name: string; ip: string; role?: string}>; note?: string; noteType?: string }> = {
    '10': {
      title: 'üü¢ VLAN 10 ‚Äî Management',
      devices: [
        { name: 'OPNsense', ip: '10.10.10.1', role: 'Firewall/Gateway' },
        { name: 'MokerLink Switch', ip: '10.10.10.2', role: 'Core L3 Switch' },
        { name: 'PITBOSS', ip: '10.10.10.100', role: 'Windows Workstation' }
      ]
    },
    '20': {
      title: 'üîµ VLAN 20 ‚Äî SOC',
      devices: [
        { name: 'smokehouse (QNAP)', ip: '10.10.20.10', role: 'SOC Platform' },
        { name: 'sear (Kali)', ip: '10.10.20.20', role: 'Attack Box' }
      ],
      note: 'Has monitoring access to all other VLANs',
      noteType: 'info'
    },
    '30': {
      title: 'üü¢ VLAN 30 ‚Äî Lab',
      devices: [
        { name: 'pitcrew', ip: '10.10.30.20', role: 'Proxmox (AD Lab)' },
        { name: 'smoker', ip: '10.10.30.21', role: 'Proxmox (Targets)' },
        { name: 'DC01', ip: '10.10.30.40', role: 'Domain Controller' },
        { name: 'WS01', ip: '10.10.30.41', role: 'Windows Workstation' }
      ],
      note: 'Domain: smokehouse.local',
      noteType: 'info'
    },
    '40': {
      title: 'üü† VLAN 40 ‚Äî Targets',
      devices: [
        { name: 'DVWA', ip: '10.10.40.10', role: 'Web Vulnerabilities' },
        { name: 'Juice Shop', ip: '10.10.40.10:3000', role: 'OWASP App' },
        { name: 'Metasploitable 3', ip: '10.10.40.20', role: 'Practice Target' }
      ],
      note: '‚ö†Ô∏è Fully isolated ‚Äî no egress allowed',
      noteType: 'warning'
    },
    '50': {
      title: 'üü£ VLAN 50 ‚Äî IoT',
      devices: [
        { name: 'TP-Link TL-SG108E', ip: '10.10.50.2', role: 'IoT Switch' },
        { name: 'Philips Hue Bridge', ip: 'DHCP', role: 'Smart Lighting' },
        { name: 'Eufy Security Hub', ip: 'DHCP', role: 'Cameras' },
        { name: 'Smart Plugs', ip: 'DHCP', role: 'Various' }
      ],
      note: 'Internet access only ‚Äî blocked from internal networks',
      noteType: 'info'
    }
  };

  function showPanel(title: string, content: string) {
    const panel = document.getElementById('arch-detail-panel');
    const titleEl = document.getElementById('arch-detail-title');
    const contentEl = document.getElementById('arch-detail-content');
    
    if (panel && titleEl && contentEl) {
      titleEl.textContent = title;
      contentEl.innerHTML = content;
      panel.classList.remove('arch-panel-hidden');
    }
  }

  function hidePanel() {
    document.getElementById('arch-detail-panel')?.classList.add('arch-panel-hidden');
  }

  // Handle component clicks
  document.querySelectorAll('.arch-node[data-component]').forEach(node => {
    node.addEventListener('click', (e) => {
      e.stopPropagation();
      const component = (node as HTMLElement).dataset.component;
      if (!component || !componentDetails[component]) return;
      
      showPanel(componentDetails[component].title, componentDetails[component].content);
    });
  });

  // Handle VLAN clicks
  document.querySelectorAll('.arch-vlan-card[data-vlan]').forEach(card => {
    card.addEventListener('click', (e) => {
      e.stopPropagation();
      const vlanId = (card as HTMLElement).dataset.vlan;
      if (!vlanId || !vlanDetails[vlanId]) return;
      
      const vlan = vlanDetails[vlanId];
      
      // Build device list HTML
      let devicesHtml = '<div class="arch-device-list">';
      vlan.devices.forEach(device => {
        devicesHtml += `
          <div class="arch-device-item">
            <div>
              <div class="arch-device-name">${device.name}</div>
              ${device.role ? `<div class="arch-device-role">${device.role}</div>` : ''}
            </div>
            <div class="arch-device-ip">${device.ip}</div>
          </div>
        `;
      });
      devicesHtml += '</div>';
      
      // Add note if present
      if (vlan.note) {
        const noteClass = vlan.noteType === 'info' ? 'arch-note-info' : '';
        devicesHtml += `<div class="arch-vlan-note ${noteClass}">${vlan.note}</div>`;
      }
      
      showPanel(vlan.title, devicesHtml);
    });
  });

  // Close panel button
  document.querySelector('.arch-detail-close')?.addEventListener('click', hidePanel);

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') hidePanel();
  });

  // Close when clicking outside
  document.addEventListener('click', (e) => {
    const panel = document.getElementById('arch-detail-panel');
    const target = e.target as HTMLElement;
    if (panel && !panel.contains(target) && !target.closest('.arch-node') && !target.closest('.arch-vlan-card')) {
      hidePanel();
    }
  });
</script>
