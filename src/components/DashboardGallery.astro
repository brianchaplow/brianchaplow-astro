---
interface Dashboard {
  src: string;
  alt: string;
  title: string;
  description: string;
  highlight?: string;
}

interface Props {
  dashboards: Dashboard[];
}

const { dashboards } = Astro.props;
---

<div class="dashboard-gallery not-prose">
  {/* Thumbnail Grid */}
  <div class="gallery-grid">
    {dashboards.map((dash, i) => (
      <button 
        class="gallery-item group"
        data-index={i}
        aria-label={`View ${dash.title}`}
      >
        <div class="gallery-image-wrap">
          <img 
            src={dash.src} 
            alt={dash.alt}
            loading="lazy"
            decoding="async"
            class="gallery-thumb"
          />
          <div class="gallery-overlay">
            <span class="gallery-zoom">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
              </svg>
            </span>
          </div>
        </div>
        <div class="gallery-info">
          <h4 class="gallery-title">{dash.title}</h4>
          <p class="gallery-desc">{dash.description}</p>
          {dash.highlight && (
            <span class="gallery-highlight">{dash.highlight}</span>
          )}
        </div>
      </button>
    ))}
  </div>

  {/* Lightbox */}
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="lightbox-backdrop"></div>
    
    <div class="lightbox-container">
      {/* Close button */}
      <button class="lightbox-close" aria-label="Close lightbox">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      
      {/* Navigation */}
      <button class="lightbox-nav lightbox-prev" aria-label="Previous image">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button class="lightbox-nav lightbox-next" aria-label="Next image">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
      
      {/* Image */}
      <div class="lightbox-content">
        <img id="lightbox-img" src="" alt="" class="lightbox-image" />
      </div>
      
      {/* Caption */}
      <div class="lightbox-caption">
        <h3 id="lightbox-title" class="lightbox-caption-title"></h3>
        <p id="lightbox-desc" class="lightbox-caption-desc"></p>
      </div>
      
      {/* Counter */}
      <div class="lightbox-counter">
        <span id="lightbox-current">1</span> / <span id="lightbox-total">{dashboards.length}</span>
      </div>
    </div>
  </div>
</div>

{/* Pass data to client */}
<script define:vars={{ dashboards }}>
  window.__dashboardData = dashboards;
</script>

<style>
  .dashboard-gallery {
    margin: 2rem 0;
  }
  
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
  }
  
  @media (min-width: 768px) {
    .gallery-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .gallery-item {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 1rem;
    overflow: hidden;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .gallery-item:hover {
    border-color: rgba(0, 212, 255, 0.3);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.3);
  }
  
  .gallery-image-wrap {
    position: relative;
    aspect-ratio: 16 / 10;
    overflow: hidden;
  }
  
  .gallery-thumb {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .gallery-item:hover .gallery-thumb {
    transform: scale(1.05);
  }
  
  .gallery-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .gallery-item:hover .gallery-overlay {
    opacity: 1;
  }
  
  .gallery-zoom {
    color: white;
    background: rgba(0, 212, 255, 0.2);
    padding: 0.75rem;
    border-radius: 50%;
    backdrop-filter: blur(4px);
  }
  
  .gallery-info {
    padding: 1.25rem;
  }
  
  .gallery-title {
    font-size: 1rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.5rem;
  }
  
  .gallery-desc {
    font-size: 0.85rem;
    color: #888;
    line-height: 1.5;
  }
  
  .gallery-highlight {
    display: inline-block;
    margin-top: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: #00d4ff;
    background: rgba(0, 212, 255, 0.1);
    padding: 0.3rem 0.6rem;
    border-radius: 0.25rem;
  }
  
  /* Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }
  
  .lightbox.active {
    opacity: 1;
    visibility: visible;
  }
  
  .lightbox-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
  }
  
  .lightbox-container {
    position: relative;
    width: 100%;
    max-width: 1200px;
    padding: 2rem;
  }
  
  .lightbox-close {
    position: absolute;
    top: 0;
    right: 0;
    padding: 0.75rem;
    color: #888;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 10;
  }
  
  .lightbox-close:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.15);
  }
  
  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    padding: 1rem;
    color: #888;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    z-index: 10;
  }
  
  .lightbox-nav:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  .lightbox-prev { left: 1rem; }
  .lightbox-next { right: 1rem; }
  
  @media (max-width: 768px) {
    .lightbox-prev { left: 0.5rem; }
    .lightbox-next { right: 0.5rem; }
    .lightbox-nav { padding: 0.5rem; }
  }
  
  .lightbox-content {
    position: relative;
    display: flex;
    justify-content: center;
  }
  
  .lightbox-image {
    max-width: 100%;
    max-height: 70vh;
    border-radius: 0.5rem;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    opacity: 0;
    transform: scale(0.95);
    transition: all 0.3s ease;
  }
  
  .lightbox.active .lightbox-image {
    opacity: 1;
    transform: scale(1);
  }
  
  .lightbox-caption {
    text-align: center;
    margin-top: 1.5rem;
    padding: 0 2rem;
  }
  
  .lightbox-caption-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.5rem;
  }
  
  .lightbox-caption-desc {
    font-size: 0.9rem;
    color: #888;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }
  
  .lightbox-counter {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #666;
  }
</style>

<script>
  interface DashboardItem {
    src: string;
    alt: string;
    title: string;
    description: string;
  }
  
  const dashboards: DashboardItem[] = (window as any).__dashboardData || [];
  let currentIndex = 0;
  
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
  const lightboxTitle = document.getElementById('lightbox-title');
  const lightboxDesc = document.getElementById('lightbox-desc');
  const lightboxCurrent = document.getElementById('lightbox-current');
  
  function showImage(index: number) {
    if (index < 0) index = dashboards.length - 1;
    if (index >= dashboards.length) index = 0;
    currentIndex = index;
    
    const dash = dashboards[index];
    if (lightboxImg) {
      lightboxImg.src = dash.src;
      lightboxImg.alt = dash.alt;
    }
    if (lightboxTitle) lightboxTitle.textContent = dash.title;
    if (lightboxDesc) lightboxDesc.textContent = dash.description;
    if (lightboxCurrent) lightboxCurrent.textContent = String(index + 1);
  }
  
  function openLightbox(index: number) {
    showImage(index);
    lightbox?.classList.add('active');
    lightbox?.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }
  
  function closeLightbox() {
    lightbox?.classList.remove('active');
    lightbox?.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }
  
  // Open on thumbnail click
  document.querySelectorAll('.gallery-item').forEach(item => {
    item.addEventListener('click', () => {
      const index = parseInt((item as HTMLElement).dataset.index || '0');
      openLightbox(index);
    });
  });
  
  // Close button
  document.querySelector('.lightbox-close')?.addEventListener('click', closeLightbox);
  
  // Backdrop click
  document.querySelector('.lightbox-backdrop')?.addEventListener('click', closeLightbox);
  
  // Navigation
  document.querySelector('.lightbox-prev')?.addEventListener('click', () => showImage(currentIndex - 1));
  document.querySelector('.lightbox-next')?.addEventListener('click', () => showImage(currentIndex + 1));
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;
    
    switch (e.key) {
      case 'Escape':
        closeLightbox();
        break;
      case 'ArrowLeft':
        showImage(currentIndex - 1);
        break;
      case 'ArrowRight':
        showImage(currentIndex + 1);
        break;
    }
  });
</script>
